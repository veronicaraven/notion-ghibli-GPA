<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghibli Grade Tracker</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Caveat', cursive;
            background: linear-gradient(135deg, #87CEEB 0%, #98D8E8 30%, #B4E7CE 100%);
            padding: 15px;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="white" opacity="0.3"/><circle cx="80" cy="30" r="1.5" fill="white" opacity="0.4"/><circle cx="60" cy="70" r="2.5" fill="white" opacity="0.2"/><circle cx="30" cy="80" r="1" fill="white" opacity="0.5"/><circle cx="90" cy="60" r="2" fill="white" opacity="0.3"/></svg>') repeat;
            animation: float 20s infinite linear;
            z-index: -1;
        }

        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100vh) rotate(360deg); }
        }

        .widget-container {
            max-width: 400px;
            margin: 0 auto;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .widget-container.expanded {
            max-width: 850px;
        }

        .container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border: 3px solid #7FB069;
            position: relative;
            transition: all 0.5s ease;
        }

        .container::before {
            content: 'üå∏';
            position: absolute;
            top: -12px;
            left: 25px;
            font-size: 24px;
            animation: bounce 2s infinite;
        }

        .container::after {
            content: 'üçÉ';
            position: absolute;
            top: -8px;
            right: 30px;
            font-size: 20px;
            animation: sway 3s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
            60% { transform: translateY(-4px); }
        }

        @keyframes sway {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        /* Minimized State */
        .header-minimized {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .grade-display {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .course-title-mini {
            font-size: 20px;
            color: #2F5233;
            font-weight: 700;
            border: none;
            background: transparent;
            font-family: 'Caveat', cursive;
            min-width: 120px;
            flex: 1;
        }

        .current-grade-mini {
            font-size: 36px;
            font-weight: 800;
            position: relative;
            display: flex;
            align-items: center;
            overflow: hidden;
            line-height: 1;
            margin: 0;
        }

        .grade-digits {
            display: inline-flex;
        }

        .digit {
            display: inline-block;
            opacity: 0;
            transform: translateY(30px) rotateX(90deg);
            animation: pixelLoad 0.6s ease-out forwards;
        }

        @keyframes pixelLoad {
            0% {
                opacity: 0;
                transform: translateY(30px) rotateX(90deg) scale(0.5);
                filter: blur(10px);
            }
            50% {
                opacity: 0.7;
                transform: translateY(15px) rotateX(45deg) scale(1.2);
                filter: blur(5px);
            }
            100% {
                opacity: 1;
                transform: translateY(0) rotateX(0deg) scale(1);
                filter: blur(0px);
            }
        }

        .progress-bar-mini {
            width: 60px;
            height: 8px;
            background: #E8F5E8;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #7FB069;
            position: relative;
        }

        .progress-fill-mini {
            height: 100%;
            border-radius: 15px;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(90deg, #7FB069, #A8D5BA);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .expand-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Caveat', cursive;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #7FB069, #A8D5BA);
            color: white;
            box-shadow: 0 4px 15px rgba(127, 176, 105, 0.3);
        }

        .expand-btn:hover {
            background: linear-gradient(135deg, #6FA055, #98C7AA);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(127, 176, 105, 0.4);
        }

        .expand-btn::before {
            content: 'üìä ';
        }

        .calcifer-icon {
            transition: all 0.3s ease;
        }

        .calcifer-icon:hover {
            transform: scale(1.1);
        }

        .calcifer-icon svg:hover {
            filter: brightness(1.1) drop-shadow(0 4px 8px rgba(255, 107, 107, 0.3));
        }

        /* Expanded State */
        .header-expanded {
            text-align: center;
            margin-bottom: 30px;
            display: none;
        }

        .course-title {
            font-size: 32px;
            color: #2F5233;
            margin-bottom: 15px;
            font-weight: 700;
            border: none;
            background: transparent;
            text-align: center;
            font-family: 'Caveat', cursive;
        }

        .current-grade {
            font-size: 52px;
            font-weight: 800;
            margin-bottom: 20px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .grade-a { color: #7FB069; }
        .grade-b { color: #4A90E2; }
        .grade-c { color: #F5A623; }
        .grade-d { color: #D0021B; }
        .grade-f { color: #8B572A; }

        .current-grade::before {
            content: '‚ú®';
            position: absolute;
            left: -50px;
            top: 10px;
            font-size: 25px;
            animation: sparkle 1.5s ease-in-out infinite;
        }

        .current-grade::after {
            content: '‚≠ê';
            position: absolute;
            right: -50px;
            top: 15px;
            font-size: 20px;
            animation: sparkle 1.5s ease-in-out infinite 0.5s;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .progress-bar {
            width: 100%;
            height: 16px;
            background: #E8F5E8;
            border-radius: 25px;
            overflow: hidden;
            margin-bottom: 35px;
            border: 2px solid #7FB069;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            border-radius: 25px;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(90deg, #7FB069, #A8D5BA);
            position: relative;
        }

        .progress-fill::after {
            content: 'üå±';
            position: absolute;
            right: -5px;
            top: -8px;
            font-size: 20px;
            animation: grow 2s ease-in-out infinite;
        }

        @keyframes grow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }

        .expanded-content {
            display: none;
        }

        .categories {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .category {
            background: linear-gradient(135deg, #F0F8E8 0%, #E8F5E8 100%);
            border-radius: 18px;
            padding: 20px;
            border-left: 5px solid #7FB069;
            border: 2px solid rgba(127, 176, 105, 0.3);
            position: relative;
            box-shadow: 0 6px 20px rgba(127, 176, 105, 0.15);
        }

        .category:nth-child(odd)::before {
            content: 'üåø';
            position: absolute;
            top: 12px;
            right: 15px;
            font-size: 20px;
        }

        .category:nth-child(even)::before {
            content: 'üå∏';
            position: absolute;
            top: 12px;
            right: 15px;
            font-size: 18px;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .category-name {
            font-weight: 700;
            color: #2F5233;
            font-size: 20px;
            border: none;
            background: transparent;
            font-family: 'Caveat', cursive;
            width: auto;
            min-width: 180px;
        }

        .category-name:focus {
            outline: 2px solid #7FB069;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
            padding: 2px 8px;
        }

        .category-weight {
            color: #5A7C65;
            font-size: 16px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid #A8D5BA;
            border-radius: 12px;
            padding: 4px 8px;
            width: 60px;
            text-align: center;
        }

        .assignments {
            display: grid;
            gap: 12px;
        }

        .assignment {
            display: grid;
            grid-template-columns: 1fr auto auto auto;
            gap: 10px;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            border: 2px solid rgba(127, 176, 105, 0.2);
            transition: all 0.3s ease;
        }

        .assignment:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 15px rgba(127, 176, 105, 0.2);
        }

        .assignment input {
            padding: 8px 12px;
            border: 2px solid #A8D5BA;
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Caveat', cursive;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .assignment input:focus {
            outline: none;
            border-color: #7FB069;
            box-shadow: 0 0 0 3px rgba(127, 176, 105, 0.2);
            background: white;
        }

        .assignment input[type="number"] {
            width: 75px;
            text-align: center;
            font-weight: 600;
        }

        .add-btn, .delete-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            font-family: 'Caveat', cursive;
            transition: all 0.3s ease;
        }

        .add-btn {
            background: linear-gradient(135deg, #7FB069, #A8D5BA);
            color: white;
            margin-top: 12px;
            box-shadow: 0 3px 12px rgba(127, 176, 105, 0.3);
        }

        .add-btn:hover {
            background: linear-gradient(135deg, #6FA055, #98C7AA);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(127, 176, 105, 0.4);
        }

        .add-btn::before {
            content: 'üå± ';
        }

        .delete-btn {
            background: linear-gradient(135deg, #FFB3BA, #FFCCCB);
            color: #8B4513;
            font-size: 16px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-btn:hover {
            background: linear-gradient(135deg, #FFA3AA, #FFBBBC);
            transform: scale(1.1);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(240, 248, 232, 0.9));
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(127, 176, 105, 0.3);
            position: relative;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(127, 176, 105, 0.2);
        }

        .stat-card:nth-child(1)::before { content: 'üìö'; }
        .stat-card:nth-child(2)::before { content: 'üéØ'; }
        .stat-card:nth-child(3)::before { content: 'üåü'; }

        .stat-card::before {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            background: white;
            padding: 4px;
            border-radius: 50%;
            border: 2px solid #A8D5BA;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 800;
            color: #7FB069;
            margin-bottom: 6px;
            margin-top: 12px;
        }

        .stat-label {
            font-size: 14px;
            color: #5A7C65;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid #7FB069;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: #2F5233;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #7FB069;
            color: white;
            transform: scale(1.1);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px) rotate(-1deg);
            }
            to {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
        }

        .assignment {
            animation: slideIn 0.4s ease-out;
        }

        .totoro-friend {
            position: fixed;
            bottom: 15px;
            right: 15px;
            font-size: 30px;
            animation: totoro-bounce 3s ease-in-out infinite;
            z-index: 100;
        }

        @keyframes totoro-bounce {
            0%, 100% { transform: translateY(0px) rotate(-5deg); }
            25% { transform: translateY(-8px) rotate(0deg); }
            50% { transform: translateY(-4px) rotate(5deg); }
            75% { transform: translateY(-12px) rotate(-2deg); }
        }

        /* Show expanded state */
        .widget-container.expanded .header-minimized {
            display: none;
        }

        .widget-container.expanded .header-expanded {
            display: block;
        }

        .widget-container.expanded .expanded-content {
            display: block;
        }

        .widget-container.expanded .close-btn {
            display: flex;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-minimized {
                flex-direction: column;
                text-align: center;
            }
            
            .assignment {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .current-grade::before,
            .current-grade::after {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="widget-container" id="widgetContainer">
        <div class="container">
            <button class="close-btn" onclick="toggleWidget()">‚úï</button>
            
            <!-- Minimized Header -->
            <div class="header-minimized">
                <div class="grade-display">
                    <input type="text" class="course-title-mini" value="‚ú® Magical Studies" onchange="updateCourseName(this.value)">
                    <div class="current-grade-mini grade-a" id="currentGradeMini">
                        <div class="grade-digits" id="gradeDigits">95.5%</div>
                    </div>
                </div>
                <div class="progress-bar-mini">
                    <div class="progress-fill-mini" id="progressFillMini" style="width: 95.5%"></div>
                </div>
                <div class="action-buttons">
                    <button class="expand-btn" onclick="toggleWidget()">View Details</button>
                    <div class="calcifer-icon">
                        <svg width="40" height="40" viewBox="0 0 100 100" style="cursor: pointer;" onclick="quickAddGrade()">
                            <!-- Flame body -->
                            <path d="M50 85 C30 85, 20 70, 25 55 C20 45, 25 35, 35 30 C40 20, 50 15, 60 20 C70 15, 80 25, 75 35 C85 40, 90 50, 85 60 C90 70, 80 85, 50 85 Z" fill="#FF6B6B" stroke="#8B4513" stroke-width="2"/>
                            <!-- Inner flame -->
                            <path d="M50 75 C35 75, 30 65, 35 55 C30 50, 35 45, 40 42 C45 35, 50 32, 55 35 C60 32, 70 40, 65 50 C70 55, 70 65, 50 75 Z" fill="#FFD93D"/>
                            <!-- Eyes -->
                            <circle cx="42" cy="50" r="8" fill="white" stroke="#8B4513" stroke-width="2"/>
                            <circle cx="58" cy="50" r="8" fill="white" stroke="#8B4513" stroke-width="2"/>
                            <circle cx="42" cy="50" r="4" fill="#8B4513"/>
                            <circle cx="58" cy="50" r="4" fill="#8B4513"/>
                            <!-- Mouth -->
                            <ellipse cx="50" cy="62" rx="12" ry="5" fill="none" stroke="#8B4513" stroke-width="3" stroke-linecap="round"/>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Expanded Header -->
            <div class="header-expanded">
                <input type="text" class="course-title" value="‚ú® Magical Studies ‚ú®" onchange="updateCourseName(this.value)">
                <div class="current-grade grade-a" id="currentGrade">95.5%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 95.5%"></div>
                </div>
            </div>

            <!-- Expanded Content -->
            <div class="expanded-content">
                <div class="categories" id="categories">
                    <div class="category">
                        <div class="category-header">
                            <input type="text" class="category-name" value="üîÆ Magical Exams" onchange="updateCategoryName(this)">
                            <input type="number" class="category-weight" value="40" min="0" max="100" onchange="updateWeights()">
                        </div>
                        <div class="assignments">
                            <div class="assignment">
                                <input type="text" placeholder="Assignment name..." value="Levitation Midterm">
                                <input type="number" placeholder="Score" min="0" max="100" value="92" onchange="calculateGrade()">
                                <input type="number" placeholder="Total" min="0" max="100" value="100" onchange="calculateGrade()">
                                <button class="delete-btn" onclick="deleteAssignment(this)">üóëÔ∏è</button>
                            </div>
                        </div>
                        <button class="add-btn" onclick="addAssignment(this)">Add Magical Test</button>
                    </div>

                    <div class="category">
                        <div class="category-header">
                            <input type="text" class="category-name" value="üìù Enchanted Homework" onchange="updateCategoryName(this)">
                            <input type="number" class="category-weight" value="30" min="0" max="100" onchange="updateWeights()">
                        </div>
                        <div class="assignments">
                            <div class="assignment">
                                <input type="text" placeholder="Assignment name..." value="Potion Recipe #1">
                                <input type="number" placeholder="Score" min="0" max="100" value="98" onchange="calculateGrade()">
                                <input type="number" placeholder="Total" min="0" max="100" value="100" onchange="calculateGrade()">
                                <button class="delete-btn" onclick="deleteAssignment(this)">üóëÔ∏è</button>
                            </div>
                            <div class="assignment">
                                <input type="text" placeholder="Assignment name..." value="Forest Spirit Essay">
                                <input type="number" placeholder="Score" min="0" max="100" value="95" onchange="calculateGrade()">
                                <input type="number" placeholder="Total" min="0" max="100" value="100" onchange="calculateGrade()">
                                <button class="delete-btn" onclick="deleteAssignment(this)">üóëÔ∏è</button>
                            </div>
                        </div>
                        <button class="add-btn" onclick="addAssignment(this)">Add Homework Quest</button>
                    </div>

                    <div class="category">
                        <div class="category-header">
                            <input type="text" class="category-name" value="üå∏ Class Participation" onchange="updateCategoryName(this)">
                            <input type="number" class="category-weight" value="20" min="0" max="100" onchange="updateWeights()">
                        </div>
                        <div class="assignments">
                            <div class="assignment">
                                <input type="text" placeholder="Assignment name..." value="Magical Discussions">
                                <input type="number" placeholder="Score" min="0" max="100" value="95" onchange="calculateGrade()">
                                <input type="number" placeholder="Total" min="0" max="100" value="100" onchange="calculateGrade()">
                                <button class="delete-btn" onclick="deleteAssignment(this)">üóëÔ∏è</button>
                            </div>
                        </div>
                        <button class="add-btn" onclick="addAssignment(this)">Add Participation</button>
                    </div>

                    <div class="category">
                        <div class="category-header">
                            <input type="text" class="category-name" value="üè∞ Final Quest" onchange="updateCategoryName(this)">
                            <input type="number" class="category-weight" value="10" min="0" max="100" onchange="updateWeights()">
                        </div>
                        <div class="assignments">
                            <div class="assignment">
                                <input type="text" placeholder="Assignment name..." value="Castle in the Sky Project">
                                <input type="number" placeholder="Score" min="0" max="100" value="" onchange="calculateGrade()">
                                <input type="number" placeholder="Total" min="0" max="100" value="100" onchange="calculateGrade()">
                                <button class="delete-btn" onclick="deleteAssignment(this)">üóëÔ∏è</button>
                            </div>
                        </div>
                        <button class="add-btn" onclick="addAssignment(this)">Add Final Quest</button>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="pointsEarned">285</div>
                        <div class="stat-label">Magic Points</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalPoints">300</div>
                        <div class="stat-label">Total Points</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completedWeight">90%</div>
                        <div class="stat-label">Quest Complete</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="totoro-friend">üå≥</div>

    <script>
        function animateGradeChange(newGrade) {
            const miniGrade = document.getElementById('gradeDigits');
            const expandedGrade = document.getElementById('currentGrade');
            
            // Convert grade to string and split into characters
            const gradeStr = newGrade.toFixed(1) + '%';
            
            // Animate mini grade with pixel effect
            miniGrade.innerHTML = '';
            expandedGrade.textContent = gradeStr;
            
            [...gradeStr].forEach((char, index) => {
                const span = document.createElement('span');
                span.className = 'digit';
                span.textContent = char;
                span.style.animationDelay = `${index * 0.1}s`;
                miniGrade.appendChild(span);
            });
        }

        function calculateGrade() {
            let totalWeightedScore = 0;
            let totalCompletedWeight = 0;
            let totalPointsEarned = 0;
            let totalPointsPossible = 0;

            const categories = document.querySelectorAll('.category');
            
            categories.forEach(category => {
                const weight = parseFloat(category.querySelector('.category-weight').value) || 0;
                const assignments = category.querySelectorAll('.assignment');
                
                let categoryScore = 0;
                let categoryTotal = 0;
                let hasScores = false;
                
                assignments.forEach(assignment => {
                    const scoreInput = assignment.querySelectorAll('input[type="number"]')[0];
                    const totalInput = assignment.querySelectorAll('input[type="number"]')[1];
                    
                    const score = parseFloat(scoreInput.value);
                    const total = parseFloat(totalInput.value) || 0;
                    
                    if (!isNaN(score) && total > 0) {
                        categoryScore += score;
                        categoryTotal += total;
                        totalPointsEarned += score;
                        hasScores = true;
                    }
                    
                    if (total > 0) {
                        totalPointsPossible += total;
                    }
                });
                
                if (hasScores && categoryTotal > 0) {
                    const categoryPercentage = (categoryScore / categoryTotal);
                    totalWeightedScore += categoryPercentage * weight;
                    totalCompletedWeight += weight;
                }
            });

            // Calculate final grade
            let finalGrade = totalCompletedWeight > 0 ? (totalWeightedScore / totalCompletedWeight) * 100 : 0;
            
            // Animate grade change
            animateGradeChange(finalGrade);
            
            // Update progress bars
            const progressFill = document.getElementById('progressFill');
            const progressFillMini = document.getElementById('progressFillMini');
            
            progressFill.style.width = Math.min(finalGrade, 100) + '%';
            progressFillMini.style.width = Math.min(finalGrade, 100) + '%';
            
            // Update grade colors
            const gradeClass = getGradeClass(finalGrade);
            document.getElementById('currentGradeMini').className = 'current-grade-mini ' + gradeClass;
            document.getElementById('currentGrade').className = 'current-grade ' + gradeClass;
            
            // Update progress bar colors and plant growth
            const gradientColors = getGradientColors(finalGrade);
            progressFill.style.background = gradientColors.gradient;
            progressFillMini.style.background = gradientColors.gradient;
            
            if (finalGrade >= 90) {
                progressFill.innerHTML = '<div style="position:absolute;right:-5px;top:-8px;font-size:20px;animation:grow 2s ease-in-out infinite;">üå≥</div>';
            } else if (finalGrade >= 80) {
                progressFill.innerHTML = '<div style="position:absolute;right:-5px;top:-8px;font-size:20px;animation:grow 2s ease-in-out infinite;">üåø</div>';
            } else if (finalGrade >= 70) {
                progressFill.innerHTML = '<div style="position:absolute;right:-5px;top:-8px;font-size:20px;animation:grow 2s ease-in-out infinite;">üå±</div>';
            } else if (finalGrade >= 60) {
                progressFill.innerHTML = '<div style="position:absolute;right:-5px;top:-8px;font-size:20px;animation:grow 2s ease-in-out infinite;">üçÇ</div>';
            } else {
                progressFill.innerHTML = '<div style="position:absolute;right:-5px;top:-8px;font-size:20px;animation:grow 2s ease-in-out infinite;">ü•Ä</div>';
            }
            
            // Update stats
            document.getElementById('pointsEarned').textContent = totalPointsEarned.toFixed(0);
            document.getElementById('totalPoints').textContent = totalPointsPossible.toFixed(0);
            document.getElementById('completedWeight').textContent = totalCompletedWeight.toFixed(0) + '%';
        }

        function getGradeClass(grade) {
            if (grade >= 90) return 'grade-a';
            if (grade >= 80) return 'grade-b';
            if (grade >= 70) return 'grade-c';
            if (grade >= 60) return 'grade-d';
            return 'grade-f';
        }

        function getGradientColors(grade) {
            if (grade >= 90) {
                return { gradient: 'linear-gradient(90deg, #7FB069, #A8D5BA)' };
            } else if (grade >= 80) {
                return { gradient: 'linear-gradient(90deg, #4A90E2, #7BB3F0)' };
            } else if (grade >= 70) {
                return { gradient: 'linear-gradient(90deg, #F5A623, #F7B955)' };
            } else if (grade >= 60) {
                return { gradient: 'linear-gradient(90deg, #D0021B, #E5334A)' };
            } else {
                return { gradient: 'linear-gradient(90deg, #8B572A, #A0694A)' };
            }
        }

        function toggleWidget() {
            const container = document.getElementById('widgetContainer');
            container.classList.toggle('expanded');
        }

        function quickAddGrade() {
            // Quick add functionality - you can expand this
            const gradeName = prompt('üå∏ What assignment did you complete?');
            const score = prompt('‚ú® What score did you get?');
            const total = prompt('üéØ What was it out of?');
            
            if (gradeName && score && total) {
                // Find first category to add to (or you could make this more sophisticated)
                const firstCategory = document.querySelector('.category .assignments');
                if (firstCategory) {
                    const newAssignment = document.createElement('div');
                    newAssignment.className = 'assignment';
                    newAssignment.innerHTML = `
                        <input type="text" placeholder="Assignment name..." value="${gradeName}">
                        <input type="number" placeholder="Score" min="0" max="100" value="${score}" onchange="calculateGrade()">
                        <input type="number" placeholder="Total" min="0" max="100" value="${total}" onchange="calculateGrade()">
                        <button class="delete-btn" onclick="deleteAssignment(this)">üóëÔ∏è</button>
                    `;
                    firstCategory.appendChild(newAssignment);
                    calculateGrade();
                    createMagicSparkle(200, 200);
                }
            }
        }

        function addAssignment(button) {
            const assignmentsContainer = button.previousElementSibling;
            const newAssignment = document.createElement('div');
            newAssignment.className = 'assignment';
            newAssignment.innerHTML = `
                <input type="text" placeholder="Assignment name...">
                <input type="number" placeholder="Score" min="0" max="100" onchange="calculateGrade()">
                <input type="number" placeholder="Total" min="0" max="100" onchange="calculateGrade()">
                <button class="delete-btn" onclick="deleteAssignment(this)">üóëÔ∏è</button>
            `;
            assignmentsContainer.appendChild(newAssignment);
        }

        function deleteAssignment(button) {
            button.parentElement.remove();
            calculateGrade();
        }

        function updateWeights() {
            calculateGrade();
        }

        function updateCategoryName(input) {
            createMagicSparkle(input.getBoundingClientRect().left + input.offsetWidth/2, 
                              input.getBoundingClientRect().top + input.offsetHeight/2);
        }

        function updateCourseName(name) {
            // Update both course name inputs
            const miniTitle = document.querySelector('.course-title-mini');
            const expandedTitle = document.querySelector('.course-title');
            if (miniTitle && expandedTitle) {
                miniTitle.value = name;
                expandedTitle.value = name + ' ‚ú®';
            }
        }

        // Initial calculation
        calculateGrade();

        // Add magical interactions
        document.addEventListener('click', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON') {
                createMagicSparkle(e.pageX, e.pageY);
            }
        });

        function createMagicSparkle(x, y) {
            const sparkles = ['‚ú®', '‚≠ê', 'üí´', 'üåü'];
            const sparkle = document.createElement('div');
            sparkle.textContent = sparkles[Math.floor(Math.random() * sparkles.length)];
            sparkle.style.position = 'fixed';
            sparkle.style.left = (x - 10) + 'px';
            sparkle.style.top = (y - 10) + 'px';
            sparkle.style.fontSize = '16px';
            sparkle.style.pointerEvents = 'none';
            sparkle.style.zIndex = '1000';
            sparkle.style.animation = 'magic-float 1s ease-out forwards';
            document.body.appendChild(sparkle);
            
            setTimeout(() => {
                sparkle.remove();
            }, 1000);
        }

        // Add magic float animation for sparkles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes magic-float {
                0% { opacity: 1; transform: translateY(0px) scale(1); }
                100% { opacity: 0; transform: translateY(-30px) scale(1.5); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
